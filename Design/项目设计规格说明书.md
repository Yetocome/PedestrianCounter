# 项目设计规格说明书

## 主要方案

**简介**

1. 根据系统适用的环境：断面式系统；
2. 根据捕捉图像的摄像头数目来划分：单目识别；
3. 基本思路：
  a. 图像预处理；
  b. 前景分割；
  c. 行人判定；
    Haar分类器 = Haar-like特征(类Haar特征) + 积分图方法 + AdaBoost + 级联；
    SVM/支持向量机/最大边缘区分类器
  d. 多目标跟踪；
    mean-shift
    Kalman/Particle filter
  d. 统计计数
4. 方案
  A 单线程方案
    描述：视频获取 -> 前景分割 -> 行人判定 -> 多目标跟踪/行人去重/丢失判定
    优点：编写简单，无兼容性问题
    缺点：过程复杂，行人易丢失
    a) 区域检测方案：断面式系统，适用面窄，速度快；
    b) 全图检测方案：适用面较宽，速度较慢；
  B 多线程方案
    描述：
      主线程：视频获取
      Thread 1: 前景分割 -> 行人判定
      Thread 2: 多目标跟踪
      公共数据结构：需要跟踪的矩形vector，判定为行人的矩形vector
    优点：思路简单，耗时短
    缺点：兼容性较差，实现依赖于系统，编写困难
5. 行人数据分析流程
    见图【数据处理逻辑】
6. 网络摄像头
	1. 安全问题
	2. 带宽占用
	3. 传输速率

**难点（精度提升）**：

1. 多变性：
  * 摄像头的架设角度：垂直、倾斜或水平 - **摄像头矫正模块**
  * 行人的多变形态；
  * 根据行人的速度：高速／低速；
  * 根据行人的聚集度：高密度／低密度
  * 采集区域的环境：强光／弱光（多变的背景）－确定阈值
2. 阴影：
  * 阴影检测：基于归一化，基于纹理，结合纹理和颜色
  * 阴影处理：形态学滤波处理
3. 实时性：  
  实时监测系统对算法要求比较高，一般而言较为复杂的算法是限制实时性的重要因素

## 备选模块
1. 前景目标检测：
  1）背景建模法：
    双背景自适应
    单高斯模型
    混合高斯模型
    滑动高斯平均
  2）帧差法
  3）光流法

2. 精度提升（由影响程度降序排列）
  1）阴影抑制（日间）：
  2）红外夜视（夜间）：
  3）光照变化：
  4）障碍物遮挡：
  5）行人重叠：
  6）摄像头架设角度：
  7）行人速度
  8）摄像头矫正

3. 行人识别 - 监督式学习

  1）基于知识的人脸检测方法
    Ø 模板匹配
    Ø 人脸特征
    Ø 形状与边缘
    Ø 纹理特性
    Ø 颜色特征
  2） 基于统计的人脸检测方法
    Ø 主成分分析与特征脸
    Ø 神经网络方法
    Ø 支持向量机
    Ø 隐马尔可夫模型
    Ø Adaboost算法

4. 目标跟踪/邻帧匹配（是否可以减轻上一步算法压力）

  基于模糊颜色直方图的目标跟踪
  基于纹理特征的目标跟踪
  基于多特征自适应融合的目标跟踪

## 可能的优化
1. 自己训练的行人库，可以考虑减少检测器的级数，能够加快速度；
2. 浮点运算定点化，这样检测速度会大大加快；
3. 充分利用粗检特征（如人眼灰度特征），快速排除非行人区域，在可能的区域才利用检测器，因为检测器是非常耗时间的；
4. 缩放扫描窗口最好不要太小，也不要太大，保证0.3~2.5米之间就好了，这样可以减少检测时间；
5. 硬件平台最好是ARM平台，用得最多的积分图计算部分用汇编来写；


## 实现的优化
1. 根据场景下行人大小自适应检测范围；

Addition：
1. 整体层面：先运行下 profiler，定位程序大部分时间是在运行哪些函数，我经常使用的是 Very Sleepy
2. CPU 并行优化，可以分三个线程，确保每个 CPU core 都是满载视频捕捉和简单预处理HOGSVM
3. GPU 优化，HOG 有 GPU 加速版本 Object Detection

_Reference_

1. 张英，基于视频的实时人数统计关键技术的研究［D］，浙江：杭州电子科技大学，2013
2.
